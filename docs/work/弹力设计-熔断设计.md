### 什么是服务熔断？
熔断这一概念来源于电子工程中的断路器（Circuit Breaker）。
在互联网系统中，当下游服务因访问压力过大而响应变慢或失败，上游服务为了保护系统整体的可用性，可以暂时切断对下游服务的调用。

**这种牺牲局部，保全整体的措施就叫做熔断**

### 解决什么问题？

IO型服务中出现1—>N扇出。子服务不可用或者调用延时较高的时候，可能会导致雪崩效应
```
导致调用A服务的请求被堵住，堵住的请求会消耗占用掉系统的线程、io等资源，
当该类请求越来越多，占用的计算机资源越来越多的时候，会导致系统瓶颈出现，
造成其他的请求同样不可用，最终导致业务系统崩溃，又称：雪崩效应
```

### 雪崩的解决方案
*（1）熔断模式：这种模式主要是参考电路熔断，如果一条线路电压过高，保险丝会熔断，防止火灾。放到我们的系统中，如果某个目标服务调用慢或者有大量超时，此时，熔断该服务的调用，对于后续调用请求，不在继续调用目标服务，直接返回，快速释放资源。如果目标服务情况好转则恢复调用。

*（2）隔离模式：这种模式就像对系统请求按类型划分成一个个小岛的一样，当某个小岛被火少光了，不会影响到其他的小岛。例如可以对不同类型的请求使用线程池来资源隔离，每种类型的请求互不影响，如果一种类型的请求线程资源耗尽，则对后续的该类型请求直接返回，不再调用后续资源。这种模式使用场景非常多，例如将一个服务拆开，对于重要的服务使用单独服务器来部署，再或者公司最近推广的多中心。

*（3）限流模式：上述的熔断模式和隔离模式都属于出错后的容错处理机制，而限流模式则可以称为预防模式。限流模式主要是提前对各个类型的请求设置最高的QPS阈值，若高于设置的阈值则对该请求直接返回，不再调用后续资源。这种模式不能解决服务依赖的问题，只能解决系统整体资源分配问题，因为没有被限流的请求依然有可能造成雪崩效应


### 熔断的设计
**1.开启熔断**

在固定时间窗口内，接口调用超时比率达到一个阈值，会开启熔断。
进入熔断状态后，后续对该服务接口的调用不再经过网络，直接执行本地的默认方法，达到服务降级的效果

**2.熔断恢复**
熔断不可能是永久的。当经过了规定时间之后，服务将从熔断状态回复过来，再次接受调用方的远程调用

![Hystirx](./img/Hystirx.png)

[references]https://juejin.im/post/5ad05373518825619d4d2f00
[references]https://blog.csdn.net/mcgwinds/article/details/51166796
[references]http://www.cnblogs.com/yangecnu/p/Introduce-Circuit-Breaker-Pattern.html
