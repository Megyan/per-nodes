# OPC模块解耦升级
---------

### 方案1 去中心化

* 1.任务分析器解析出需要执行的任务ABC
  > 假设C依赖于A
* 2.推送任务消息ABC
  > 发送3条消息，每条任务消息内都包含ABC
* 3.任务执行节点ABC，接收到任务消息，check通过后执行任务
    > check 任务是否被执行过
    > check 任务执行的先决条件是否满足
* 4.任务节点执行完毕后[^sample_footnote]，重新广播全量任务消息

【缺点】放大了jmq的消息量
【优点】不需要任务调度器
【适用场景】任务依赖较少时，可以参考

### 方案2 任务调度 

* 1.任务分析器解析出需要执行的任务ABC，将任务内容和顺序通知任务调度器
  > 假设C依赖于A。
* 2.任务调度器用FIFO表记录记录任务的节点和顺序
  > 由于任务节点是分布的，所以该FIFO表应该是基于公共存储如JimDB
  > 这个公共存储要考虑持久化和高可用
* 3.任务调度器推送任务消息A和B，等待任务执行回执
* 3.任务执行节点AB，接收到任务消息后执行任务，成功后通知任务调度器。
  > 暂时将任务解析器和任务调度器合并
* 4.任务调度器推出A B后，推出任务C的消息。

【优点】减少了消息通信
【缺点】需要对任务调度进行较大的投入
 适用场景】任务节点数较多，且依赖关系复杂时，可以参考

### 方案3 信息自补偿 

* 1.任务分析器解析出需要执行的任务ABC
  > 假设C依赖于A。
* 2.推送任务消息ABC
  > 发出3条消息，分别是A、B、C
* 3.任务执行节点ABC，接收到任务消息check通过后执行任务
  > C节点check A是否执行过，如果未执行，先执行A

【优点】减少了消息通信，也无需加入任务调度
【缺点】对于依赖关系复杂的任务，无法做到任务间解耦，节点的依赖关系依然是散落在每个节点中
【适用场景】节点间依赖较少，可以参考

-----------

当前只有一个依赖，3是当前业务下解耦最廉价的方式。